var qi=Object.defineProperty;var Di=(i,e,t)=>e in i?qi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var N=(i,e,t)=>Di(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function Ii(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function Mi(i,e,t,s,n){const r={move:i,variations:n};return e&&(r.suffix=e),t&&(r.nag=t),s!==null&&(r.comment=s),r}function Ui(...i){const[e,...t]=i;let s=e;for(const n of t)n!==null&&(s.variations=[n,...n.variations],n.variations=[],s=n);return e}function Vi(i,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const s=t.variations[0];if(!s){t.comment=e.marker.comment;break}t=s}}return{headers:i,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function Hi(i,e){function t(){this.constructor=i}t.prototype=e.prototype,i.prototype=new t}function ie(i,e,t,s){var n=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(n,ie.prototype),n.expected=e,n.found=t,n.location=s,n.name="SyntaxError",n}Hi(ie,Error);function Me(i,e,t){return t=t||" ",i.length>e?i:(e-=i.length,t+=t.repeat(e),i+t.slice(0,e))}ie.prototype.format=function(i){var e="Error: "+this.message;if(this.location){var t=null,s;for(s=0;s<i.length;s++)if(i[s].source===this.location.source){t=i[s].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,r=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(n):n,o=this.location.source+":"+r.line+":"+r.column;if(t){var c=this.location.end,l=Me("",r.line.toString().length," "),p=t[n.line-1],g=n.line===c.line?c.column:p.length+1,y=g-n.column||1;e+=`
 --> `+o+`
`+l+` |
`+r.line+" | "+p+`
`+l+" | "+Me("",n.column-1," ")+Me("",y,"^")}else e+=`
 at `+o}return e};ie.buildMessage=function(i,e){var t={literal:function(p){return'"'+n(p.text)+'"'},class:function(p){var g=p.parts.map(function(y){return Array.isArray(y)?r(y[0])+"-"+r(y[1]):r(y)});return"["+(p.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function s(p){return p.charCodeAt(0).toString(16).toUpperCase()}function n(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+s(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+s(g)})}function r(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+s(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+s(g)})}function o(p){return t[p.type](p)}function c(p){var g=p.map(o),y,A;if(g.sort(),g.length>0){for(y=1,A=1;y<g.length;y++)g[y-1]!==g[y]&&(g[A]=g[y],A++);g.length=A}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function l(p){return p?'"'+n(p)+'"':"end of input"}return"Expected "+c(i)+" but "+l(e)+" found."};function Fi(i,e){e=e!==void 0?e:{};var t={},s=e.grammarSource,n={pgn:Mt},r=Mt,o="[",c='"',l="]",p=".",g="O-O-O",y="O-O",A="0-0-0",k="0-0",b="$",T="{",x="}",X=";",Le="(",Re=")",yt="1-0",vt="0-1",bt="1/2-1/2",Rs="*",qe=/^[a-zA-Z]/,wt=/^[^"]/,de=/^[0-9]/,_t=/^[.]/,St=/^[a-zA-Z1-8\-=]/,qs=/^[+#]/,Et=/^[!?]/,Ct=/^[^}]/,kt=/^[^\r\n]/,Bt=/^[ \t\r\n]/,Ds=V("tag pair"),Is=R("[",!1),Nt=R('"',!1),Ms=R("]",!1),Us=V("tag name"),De=W([["a","z"],["A","Z"]],!1,!1),Vs=V("tag value"),xt=W(['"'],!0,!1),Hs=V("move number"),pe=W([["0","9"]],!1,!1),Fs=R(".",!1),Tt=W(["."],!1,!1),Ks=V("standard algebraic notation"),Gs=R("O-O-O",!1),Ws=R("O-O",!1),Ys=R("0-0-0",!1),js=R("0-0",!1),Ot=W([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Xs=W(["+","#"],!1,!1),Qs=V("suffix annotation"),Pt=W(["!","?"],!1,!1),Js=V("NAG"),zs=R("$",!1),Zs=V("brace comment"),$s=R("{",!1),Lt=W(["}"],!0,!1),ei=R("}",!1),ti=V("rest of line comment"),si=R(";",!1),Rt=W(["\r",`
`],!0,!1),ii=V("variation"),ni=R("(",!1),ri=R(")",!1),oi=V("game termination marker"),ai=R("1-0",!1),ci=R("0-1",!1),li=R("1/2-1/2",!1),hi=R("*",!1),fi=V("whitespace"),qt=W([" ","	","\r",`
`],!1,!1),ui=function(a,f){return Vi(a,f)},di=function(a){return Object.fromEntries(a)},pi=function(a,f){return[a,f]},gi=function(a,f){return{root:a,marker:f}},Ai=function(a,f){return Ui(Ii(a),...f.flat())},mi=function(a,f,u,w,_){return Mi(a,f,u,w,_)},yi=function(a){return a},vi=function(a){return a.replace(/[\r\n]+/g," ")},bi=function(a){return a.trim()},wi=function(a){return a},_i=function(a,f){return{result:a,comment:f}},h=e.peg$currPos|0,se=[{line:1,column:1}],F=h,ge=e.peg$maxFailExpected||[],m=e.peg$silentFails|0,oe;if(e.startRule){if(!(e.startRule in n))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');r=n[e.startRule]}function R(a,f){return{type:"literal",text:a,ignoreCase:f}}function W(a,f,u){return{type:"class",parts:a,inverted:f,ignoreCase:u}}function Si(){return{type:"end"}}function V(a){return{type:"other",description:a}}function Dt(a){var f=se[a],u;if(f)return f;if(a>=se.length)u=se.length-1;else for(u=a;!se[--u];);for(f=se[u],f={line:f.line,column:f.column};u<a;)i.charCodeAt(u)===10?(f.line++,f.column=1):f.column++,u++;return se[a]=f,f}function It(a,f,u){var w=Dt(a),_=Dt(f),B={source:s,start:{offset:a,line:w.line,column:w.column},end:{offset:f,line:_.line,column:_.column}};return B}function v(a){h<F||(h>F&&(F=h,ge=[]),ge.push(a))}function Ei(a,f,u){return new ie(ie.buildMessage(a,f),a,f,u)}function Mt(){var a,f,u;return a=h,f=Ci(),u=Ni(),a=ui(f,u),a}function Ci(){var a,f,u;for(a=h,f=[],u=Ut();u!==t;)f.push(u),u=Ut();return u=M(),a=di(f),a}function Ut(){var a,f,u,w,_,B,$;return m++,a=h,M(),i.charCodeAt(h)===91?(f=o,h++):(f=t,m===0&&v(Is)),f!==t?(M(),u=ki(),u!==t?(M(),i.charCodeAt(h)===34?(w=c,h++):(w=t,m===0&&v(Nt)),w!==t?(_=Bi(),i.charCodeAt(h)===34?(B=c,h++):(B=t,m===0&&v(Nt)),B!==t?(M(),i.charCodeAt(h)===93?($=l,h++):($=t,m===0&&v(Ms)),$!==t?a=pi(u,_):(h=a,a=t)):(h=a,a=t)):(h=a,a=t)):(h=a,a=t)):(h=a,a=t),m--,a===t&&m===0&&v(Ds),a}function ki(){var a,f,u;if(m++,a=h,f=[],u=i.charAt(h),qe.test(u)?h++:(u=t,m===0&&v(De)),u!==t)for(;u!==t;)f.push(u),u=i.charAt(h),qe.test(u)?h++:(u=t,m===0&&v(De));else f=t;return f!==t?a=i.substring(a,h):a=f,m--,a===t&&(f=t,m===0&&v(Us)),a}function Bi(){var a,f,u;for(m++,a=h,f=[],u=i.charAt(h),wt.test(u)?h++:(u=t,m===0&&v(xt));u!==t;)f.push(u),u=i.charAt(h),wt.test(u)?h++:(u=t,m===0&&v(xt));return a=i.substring(a,h),m--,f=t,m===0&&v(Vs),a}function Ni(){var a,f,u;return a=h,f=Vt(),M(),u=Ri(),u===t&&(u=null),M(),a=gi(f,u),a}function Vt(){var a,f,u,w;for(a=h,f=Ie(),f===t&&(f=null),u=[],w=Ht();w!==t;)u.push(w),w=Ht();return a=Ai(f,u),a}function Ht(){var a,f,u,w,_,B,$,Ae;if(a=h,M(),xi(),M(),f=Ti(),f!==t){for(u=Oi(),u===t&&(u=null),w=[],_=Ft();_!==t;)w.push(_),_=Ft();for(_=M(),B=Ie(),B===t&&(B=null),$=[],Ae=Kt();Ae!==t;)$.push(Ae),Ae=Kt();a=mi(f,u,w,B,$)}else h=a,a=t;return a}function xi(){var a,f,u,w,_,B;for(m++,a=h,f=[],u=i.charAt(h),de.test(u)?h++:(u=t,m===0&&v(pe));u!==t;)f.push(u),u=i.charAt(h),de.test(u)?h++:(u=t,m===0&&v(pe));if(i.charCodeAt(h)===46?(u=p,h++):(u=t,m===0&&v(Fs)),u!==t){for(w=M(),_=[],B=i.charAt(h),_t.test(B)?h++:(B=t,m===0&&v(Tt));B!==t;)_.push(B),B=i.charAt(h),_t.test(B)?h++:(B=t,m===0&&v(Tt));f=[f,u,w,_],a=f}else h=a,a=t;return m--,a===t&&(f=t,m===0&&v(Hs)),a}function Ti(){var a,f,u,w,_,B;if(m++,a=h,f=h,i.substr(h,5)===g?(u=g,h+=5):(u=t,m===0&&v(Gs)),u===t&&(i.substr(h,3)===y?(u=y,h+=3):(u=t,m===0&&v(Ws)),u===t&&(i.substr(h,5)===A?(u=A,h+=5):(u=t,m===0&&v(Ys)),u===t&&(i.substr(h,3)===k?(u=k,h+=3):(u=t,m===0&&v(js)),u===t))))if(u=h,w=i.charAt(h),qe.test(w)?h++:(w=t,m===0&&v(De)),w!==t){if(_=[],B=i.charAt(h),St.test(B)?h++:(B=t,m===0&&v(Ot)),B!==t)for(;B!==t;)_.push(B),B=i.charAt(h),St.test(B)?h++:(B=t,m===0&&v(Ot));else _=t;_!==t?(w=[w,_],u=w):(h=u,u=t)}else h=u,u=t;return u!==t?(w=i.charAt(h),qs.test(w)?h++:(w=t,m===0&&v(Xs)),w===t&&(w=null),u=[u,w],f=u):(h=f,f=t),f!==t?a=i.substring(a,h):a=f,m--,a===t&&(f=t,m===0&&v(Ks)),a}function Oi(){var a,f,u;for(m++,a=h,f=[],u=i.charAt(h),Et.test(u)?h++:(u=t,m===0&&v(Pt));u!==t;)f.push(u),f.length>=2?u=t:(u=i.charAt(h),Et.test(u)?h++:(u=t,m===0&&v(Pt)));return f.length<1?(h=a,a=t):a=f,m--,a===t&&(f=t,m===0&&v(Qs)),a}function Ft(){var a,f,u,w,_;if(m++,a=h,M(),i.charCodeAt(h)===36?(f=b,h++):(f=t,m===0&&v(zs)),f!==t){if(u=h,w=[],_=i.charAt(h),de.test(_)?h++:(_=t,m===0&&v(pe)),_!==t)for(;_!==t;)w.push(_),_=i.charAt(h),de.test(_)?h++:(_=t,m===0&&v(pe));else w=t;w!==t?u=i.substring(u,h):u=w,u!==t?a=yi(u):(h=a,a=t)}else h=a,a=t;return m--,a===t&&m===0&&v(Js),a}function Ie(){var a;return a=Pi(),a===t&&(a=Li()),a}function Pi(){var a,f,u,w,_;if(m++,a=h,i.charCodeAt(h)===123?(f=T,h++):(f=t,m===0&&v($s)),f!==t){for(u=h,w=[],_=i.charAt(h),Ct.test(_)?h++:(_=t,m===0&&v(Lt));_!==t;)w.push(_),_=i.charAt(h),Ct.test(_)?h++:(_=t,m===0&&v(Lt));u=i.substring(u,h),i.charCodeAt(h)===125?(w=x,h++):(w=t,m===0&&v(ei)),w!==t?a=vi(u):(h=a,a=t)}else h=a,a=t;return m--,a===t&&(f=t,m===0&&v(Zs)),a}function Li(){var a,f,u,w,_;if(m++,a=h,i.charCodeAt(h)===59?(f=X,h++):(f=t,m===0&&v(si)),f!==t){for(u=h,w=[],_=i.charAt(h),kt.test(_)?h++:(_=t,m===0&&v(Rt));_!==t;)w.push(_),_=i.charAt(h),kt.test(_)?h++:(_=t,m===0&&v(Rt));u=i.substring(u,h),a=bi(u)}else h=a,a=t;return m--,a===t&&(f=t,m===0&&v(ti)),a}function Kt(){var a,f,u,w;return m++,a=h,M(),i.charCodeAt(h)===40?(f=Le,h++):(f=t,m===0&&v(ni)),f!==t?(u=Vt(),u!==t?(M(),i.charCodeAt(h)===41?(w=Re,h++):(w=t,m===0&&v(ri)),w!==t?a=wi(u):(h=a,a=t)):(h=a,a=t)):(h=a,a=t),m--,a===t&&m===0&&v(ii),a}function Ri(){var a,f,u;return m++,a=h,i.substr(h,3)===yt?(f=yt,h+=3):(f=t,m===0&&v(ai)),f===t&&(i.substr(h,3)===vt?(f=vt,h+=3):(f=t,m===0&&v(ci)),f===t&&(i.substr(h,7)===bt?(f=bt,h+=7):(f=t,m===0&&v(li)),f===t&&(i.charCodeAt(h)===42?(f=Rs,h++):(f=t,m===0&&v(hi))))),f!==t?(M(),u=Ie(),u===t&&(u=null),a=_i(f,u)):(h=a,a=t),m--,a===t&&(f=t,m===0&&v(oi)),a}function M(){var a,f;for(m++,a=[],f=i.charAt(h),Bt.test(f)?h++:(f=t,m===0&&v(qt));f!==t;)a.push(f),f=i.charAt(h),Bt.test(f)?h++:(f=t,m===0&&v(qt));return m--,f=t,m===0&&v(fi),a}if(oe=r(),e.peg$library)return{peg$result:oe,peg$currPos:h,peg$FAILED:t,peg$maxFailExpected:ge,peg$maxFailPos:F};if(oe!==t&&h===i.length)return oe;throw oe!==t&&h<i.length&&v(Si()),Ei(ge,F<i.length?i.charAt(F):null,F<i.length?It(F,F+1):It(F,F))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const we=0xffffffffffffffffn;function Ue(i,e){return(i<<e|i>>64n-e)&0xffffffffffffffffn}function Gt(i,e){return i*e&we}function Ki(i){return function(){let e=BigInt(i&we),t=BigInt(i>>64n&we);const s=Gt(Ue(Gt(e,5n),7n),9n);return t^=e,e=(Ue(e,24n)^t^t<<16n)&we,t=Ue(t,37n),i=t<<64n|e,s}}const xe=Ki(0xa187eb39cdcaed8f31c4b365b102e01en),Gi=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>xe()))),Wi=Array.from({length:8},()=>xe()),Yi=Array.from({length:16},()=>xe()),Ve=xe(),I="w",U="b",O="p",ze="n",_e="b",le="r",z="q",L="k",He="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class me{constructor(e,t){N(this,"color");N(this,"from");N(this,"to");N(this,"piece");N(this,"captured");N(this,"promotion");N(this,"flags");N(this,"san");N(this,"lan");N(this,"before");N(this,"after");const{color:s,piece:n,from:r,to:o,flags:c,captured:l,promotion:p}=t,g=q(r),y=q(o);this.color=s,this.piece=n,this.from=g,this.to=y,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=g+y,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const A in E)E[A]&c&&(this.flags+=ee[A]);l&&(this.captured=l),p&&(this.promotion=p,this.lan+=p)}isCapture(){return this.flags.indexOf(ee.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(ee.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(ee.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(ee.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(ee.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(ee.BIG_PAWN)>-1}}const D=-1,ee={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},E={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Ze={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},ji={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Xi={...Ze,...ji},S={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Fe={b:[16,32,17,15],w:[-16,-32,-17,-15]},Wt={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Qi=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ji=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],zi={p:1,n:2,b:4,r:8,q:16,k:32},Zi="pnbrqkPNBRQK",Yt=[ze,_e,le,z],$i=7,en=6,tn=1,sn=0,ye={[L]:E.KSIDE_CASTLE,[z]:E.QSIDE_CASTLE},Q={w:[{square:S.a1,flag:E.QSIDE_CASTLE},{square:S.h1,flag:E.KSIDE_CASTLE}],b:[{square:S.a8,flag:E.QSIDE_CASTLE},{square:S.h8,flag:E.KSIDE_CASTLE}]},nn={b:tn,w:en},Ke="--";function te(i){return i>>4}function fe(i){return i&15}function as(i){return"0123456789".indexOf(i)!==-1}function q(i){const e=fe(i),t=te(i);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function ae(i){return i===I?U:I}function rn(i){const e=i.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const n=e[0].split("/");if(n.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<n.length;o++){let c=0,l=!1;for(let p=0;p<n[o].length;p++)if(as(n[o][p])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};c+=parseInt(n[o][p],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[o][p]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};c+=1,l=!1}if(c!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const r=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:c}of r){if(!c.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(c)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(n[0]+n[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function on(i,e){const t=i.from,s=i.to,n=i.piece;let r=0,o=0,c=0;for(let l=0,p=e.length;l<p;l++){const g=e[l].from,y=e[l].to,A=e[l].piece;n===A&&t!==g&&s===y&&(r++,te(t)===te(g)&&o++,fe(t)===fe(g)&&c++)}return r>0?o>0&&c>0?q(t):c>0?q(t).charAt(1):q(t).charAt(0):""}function J(i,e,t,s,n,r=void 0,o=E.NORMAL){const c=te(s);if(n===O&&(c===$i||c===sn))for(let l=0;l<Yt.length;l++){const p=Yt[l];i.push({color:e,from:t,to:s,piece:n,captured:r,promotion:p,flags:o|E.PROMOTION})}else i.push({color:e,from:t,to:s,piece:n,captured:r,flags:o})}function jt(i){let e=i.charAt(0);return e>="a"&&e<="h"?i.match(/[a-h]\d.*[a-h]\d/)?void 0:O:(e=e.toLowerCase(),e==="o"?L:e)}function Ge(i){return i.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Se{constructor(e=He,{skipValidation:t=!1}={}){N(this,"_board",new Array(128));N(this,"_turn",I);N(this,"_header",{});N(this,"_kings",{w:D,b:D});N(this,"_epSquare",-1);N(this,"_halfMoves",0);N(this,"_moveNumber",0);N(this,"_history",[]);N(this,"_comments",{});N(this,"_castling",{w:0,b:0});N(this,"_hash",0n);N(this,"_positionCount",new Map);this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:D,b:D},this._turn=I,this._castling={w:0,b:0},this._epSquare=D,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...Xi},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:s=!1}={}){let n=e.split(/\s+/);if(n.length>=2&&n.length<6){const c=["-","-","0","1"];e=n.concat(c.slice(-(6-n.length))).join(" ")}if(n=e.split(/\s+/),!t){const{ok:c,error:l}=rn(e);if(!c)throw new Error(l)}const r=n[0];let o=0;this.clear({preserveHeaders:s});for(let c=0;c<r.length;c++){const l=r.charAt(c);if(l==="/")o+=8;else if(as(l))o+=parseInt(l,10);else{const p=l<"a"?I:U;this._put({type:l.toLowerCase(),color:p},q(o)),o++}}this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=E.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=E.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=E.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=E.QSIDE_CASTLE),this._epSquare=n[3]==="-"?D:S[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){var o,c;let t=0,s="";for(let l=S.a8;l<=S.h1;l++){if(this._board[l]){t>0&&(s+=t,t=0);const{color:p,type:g}=this._board[l];s+=p===I?g.toUpperCase():g.toLowerCase()}else t++;l+1&136&&(t>0&&(s+=t),l!==S.h1&&(s+="/"),t=0,l+=8)}let n="";this._castling[I]&E.KSIDE_CASTLE&&(n+="K"),this._castling[I]&E.QSIDE_CASTLE&&(n+="Q"),this._castling[U]&E.KSIDE_CASTLE&&(n+="k"),this._castling[U]&E.QSIDE_CASTLE&&(n+="q"),n=n||"-";let r="-";if(this._epSquare!==D)if(e)r=q(this._epSquare);else{const l=this._epSquare+(this._turn===I?16:-16),p=[l+1,l-1];for(const g of p){if(g&136)continue;const y=this._turn;if(((o=this._board[g])==null?void 0:o.color)===y&&((c=this._board[g])==null?void 0:c.type)===O){this._makeMove({color:y,from:g,to:this._epSquare,piece:O,captured:O,flags:E.EP_CAPTURE});const A=!this._isKingAttacked(y);if(this._undoMove(),A){r=q(this._epSquare);break}}}}return[s,this._turn,n,r,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:t,type:s}=this._board[e],n={w:0,b:1}[t],r={p:0,n:1,b:2,r:3,q:4,k:5}[s];return Gi[n][r][e]}_epKey(){return this._epSquare===D?0n:Wi[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return Yi[e]}_computeHash(){let e=0n;for(let t=S.a8;t<=S.h1;t++){if(t&136){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=Ve),e}_updateSetup(e){this._history.length>0||(e!==He?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(He)}get(e){return this._board[S[e]]}findPiece(e){var s;const t=[];for(let n=S.a8;n<=S.h1;n++){if(n&136){n+=7;continue}!this._board[n]||((s=this._board[n])==null?void 0:s.color)!==e.color||this._board[n].color===e.color&&this._board[n].type===e.type&&t.push(q(n))}return t}put({type:e,color:t},s){return this._put({type:e,color:t},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},s){if(Zi.indexOf(e.toLowerCase())===-1||!(s in S))return!1;const n=S[s];if(e==L&&!(this._kings[t]==D||this._kings[t]==n))return!1;const r=this._board[n];return r&&r.type===L&&(this._kings[r.color]=D),this._set(n,{type:e,color:t}),e===L&&(this._kings[t]=n),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const t=this.get(e);return this._clear(S[e]),t&&t.type===L&&(this._kings[t.color]=D),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){var s,n,r,o,c,l,p,g,y,A,k,b;this._hash^=this._castlingKey();const e=((s=this._board[S.e1])==null?void 0:s.type)===L&&((n=this._board[S.e1])==null?void 0:n.color)===I,t=((r=this._board[S.e8])==null?void 0:r.type)===L&&((o=this._board[S.e8])==null?void 0:o.color)===U;(!e||((c=this._board[S.a1])==null?void 0:c.type)!==le||((l=this._board[S.a1])==null?void 0:l.color)!==I)&&(this._castling.w&=-65),(!e||((p=this._board[S.h1])==null?void 0:p.type)!==le||((g=this._board[S.h1])==null?void 0:g.color)!==I)&&(this._castling.w&=-33),(!t||((y=this._board[S.a8])==null?void 0:y.type)!==le||((A=this._board[S.a8])==null?void 0:A.color)!==U)&&(this._castling.b&=-65),(!t||((k=this._board[S.h8])==null?void 0:k.type)!==le||((b=this._board[S.h8])==null?void 0:b.color)!==U)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var r,o;if(this._epSquare===D)return;const e=this._epSquare+(this._turn===I?-16:16),t=this._epSquare+(this._turn===I?16:-16),s=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((r=this._board[t])==null?void 0:r.color)!==ae(this._turn)||((o=this._board[t])==null?void 0:o.type)!==O){this._hash^=this._epKey(),this._epSquare=D;return}const n=c=>{var l,p;return!(c&136)&&((l=this._board[c])==null?void 0:l.color)===this._turn&&((p=this._board[c])==null?void 0:p.type)===O};s.some(n)||(this._hash^=this._epKey(),this._epSquare=D)}_attacked(e,t,s){const n=[];for(let r=S.a8;r<=S.h1;r++){if(r&136){r+=7;continue}if(this._board[r]===void 0||this._board[r].color!==e)continue;const o=this._board[r],c=r-t;if(c===0)continue;const l=c+119;if(Qi[l]&zi[o.type]){if(o.type===O){if(c>0&&o.color===I||c<=0&&o.color===U)if(s)n.push(q(r));else return!0;continue}if(o.type==="n"||o.type==="k")if(s){n.push(q(r));continue}else return!0;const p=Ji[l];let g=r+p,y=!1;for(;g!==t;){if(this._board[g]!=null){y=!0;break}g+=p}if(!y)if(s){n.push(q(r));continue}else return!0}}return s?n:!1}attackers(e,t){return t?this._attacked(t,S[e],!0):this._attacked(this._turn,S[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(ae(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,S[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let s=0,n=0;for(let r=S.a8;r<=S.h1;r++){if(n=(n+1)%2,r&136){r+=7;continue}const o=this._board[r];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===_e&&t.push(n),s++)}if(s===2)return!0;if(s===3&&(e[_e]===1||e[ze]===1))return!0;if(s===e[_e]+2){let r=0;const o=t.length;for(let c=0;c<o;c++)r+=t[c];if(r===0||r===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:s=void 0}={}){const n=this._moves({square:t,piece:s});return e?n.map(r=>new me(this,r)):n.map(r=>this._moveToSan(r,n))}_moves({legal:e=!0,piece:t=void 0,square:s=void 0}={}){var k;const n=s?s.toLowerCase():void 0,r=t==null?void 0:t.toLowerCase(),o=[],c=this._turn,l=ae(c);let p=S.a8,g=S.h1,y=!1;if(n)if(n in S)p=g=S[n],y=!0;else return[];for(let b=p;b<=g;b++){if(b&136){b+=7;continue}if(!this._board[b]||this._board[b].color===l)continue;const{type:T}=this._board[b];let x;if(T===O){if(r&&r!==T)continue;x=b+Fe[c][0],this._board[x]||(J(o,c,b,x,O),x=b+Fe[c][1],nn[c]===te(b)&&!this._board[x]&&J(o,c,b,x,O,void 0,E.BIG_PAWN));for(let X=2;X<4;X++)x=b+Fe[c][X],!(x&136)&&(((k=this._board[x])==null?void 0:k.color)===l?J(o,c,b,x,O,this._board[x].type,E.CAPTURE):x===this._epSquare&&J(o,c,b,x,O,O,E.EP_CAPTURE))}else{if(r&&r!==T)continue;for(let X=0,Le=Wt[T].length;X<Le;X++){const Re=Wt[T][X];for(x=b;x+=Re,!(x&136);){if(!this._board[x])J(o,c,b,x,T);else{if(this._board[x].color===c)break;J(o,c,b,x,T,this._board[x].type,E.CAPTURE);break}if(T===ze||T===L)break}}}}if((r===void 0||r===L)&&(!y||g===this._kings[c])){if(this._castling[c]&E.KSIDE_CASTLE){const b=this._kings[c],T=b+2;!this._board[b+1]&&!this._board[T]&&!this._attacked(l,this._kings[c])&&!this._attacked(l,b+1)&&!this._attacked(l,T)&&J(o,c,this._kings[c],T,L,void 0,E.KSIDE_CASTLE)}if(this._castling[c]&E.QSIDE_CASTLE){const b=this._kings[c],T=b-2;!this._board[b-1]&&!this._board[b-2]&&!this._board[b-3]&&!this._attacked(l,this._kings[c])&&!this._attacked(l,b-1)&&!this._attacked(l,T)&&J(o,c,this._kings[c],T,L,void 0,E.QSIDE_CASTLE)}}if(!e||this._kings[c]===-1)return o;const A=[];for(let b=0,T=o.length;b<T;b++)this._makeMove(o[b]),this._isKingAttacked(c)||A.push(o[b]),this._undoMove();return A}move(e,{strict:t=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,t);else if(e===null)s=this._moveFromSan(Ke,t);else if(typeof e=="object"){const r=this._moves();for(let o=0,c=r.length;o<c;o++)if(e.from===q(r[o].from)&&e.to===q(r[o].to)&&(!("promotion"in r[o])||e.promotion===r[o].promotion)){s=r[o];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&s.flags&E.NULL_MOVE)throw new Error("Null move not allowed when in check");const n=new me(this,s);return this._makeMove(s),this._incPositionCount(),n}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){var n,r,o,c;const t=this._turn,s=ae(t);if(this._push(e),e.flags&E.NULL_MOVE){t===U&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=D;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&E.EP_CAPTURE&&(this._turn===U?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),this._board[e.to].type===L){if(this._kings[t]=e.to,e.flags&E.KSIDE_CASTLE){const l=e.to-1,p=e.to+1;this._movePiece(p,l)}else if(e.flags&E.QSIDE_CASTLE){const l=e.to+1,p=e.to-2;this._movePiece(p,l)}this._castling[t]=0}if(this._castling[t]){for(let l=0,p=Q[t].length;l<p;l++)if(e.from===Q[t][l].square&&this._castling[t]&Q[t][l].flag){this._castling[t]^=Q[t][l].flag;break}}if(this._castling[s]){for(let l=0,p=Q[s].length;l<p;l++)if(e.to===Q[s][l].square&&this._castling[s]&Q[s][l].flag){this._castling[s]^=Q[s][l].flag;break}}if(this._hash^=this._castlingKey(),e.flags&E.BIG_PAWN){let l;t===U?l=e.to-16:l=e.to+16,!(e.to-1&136)&&((n=this._board[e.to-1])==null?void 0:n.type)===O&&((r=this._board[e.to-1])==null?void 0:r.color)===s||!(e.to+1&136)&&((o=this._board[e.to+1])==null?void 0:o.type)===O&&((c=this._board[e.to+1])==null?void 0:c.color)===s?(this._epSquare=l,this._hash^=this._epKey()):this._epSquare=D}else this._epSquare=D;e.piece===O?this._halfMoves=0:e.flags&(E.CAPTURE|E.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===U&&this._moveNumber++,this._turn=s,this._hash^=Ve}undo(){const e=this._hash,t=this._undoMove();if(t){const s=new me(this,t);return this._decPositionCount(e),s}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=Ve;const s=this._turn,n=ae(s);if(t.flags&E.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:s})),t.captured)if(t.flags&E.EP_CAPTURE){let r;s===U?r=t.to-16:r=t.to+16,this._set(r,{type:O,color:n})}else this._set(t.to,{type:t.captured,color:n});if(t.flags&(E.KSIDE_CASTLE|E.QSIDE_CASTLE)){let r,o;t.flags&E.KSIDE_CASTLE?(r=t.to+1,o=t.to-1):(r=t.to-2,o=t.to+1),this._movePiece(o,r)}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const s=[];let n=!1;for(const A in this._header)this._header[A]&&s.push(`[${A} "${this._header[A]}"]`+e),n=!0;n&&this._history.length&&s.push(e);const r=A=>{const k=this._comments[this.fen()];if(typeof k<"u"){const b=A.length>0?" ":"";A=`${A}${b}{${k}}`}return A},o=[];for(;this._history.length>0;)o.push(this._undoMove());const c=[];let l="";for(o.length===0&&c.push(r(""));o.length>0;){l=r(l);const A=o.pop();if(!A)break;if(!this._history.length&&A.color==="b"){const k=`${this._moveNumber}. ...`;l=l?`${l} ${k}`:k}else A.color==="w"&&(l.length&&c.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(A,this._moves({legal:!0})),this._makeMove(A)}if(l.length&&c.push(r(l)),c.push(this._header.Result||"*"),t===0)return s.join("")+c.join(" ");const p=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},g=function(A,k){for(const b of k.split(" "))if(b){if(A+b.length>t){for(;p();)A--;s.push(e),A=0}s.push(b),A+=b.length,s.push(" "),A++}return p()&&A--,A};let y=0;for(let A=0;A<c.length;A++){if(y+c[A].length>t&&c[A].includes("{")){y=g(y,c[A]);continue}y+c[A].length>t&&A!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),y=0):A!==0&&(s.push(" "),y++),s.push(c[A]),y+=c[A].length}return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??Ze[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=Ze[e]||null,!0):!1}getHeaders(){const e={};for(const[t,s]of Object.entries(this._header))s!==null&&(e[t]=s);return e}loadPgn(e,{strict:t=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(e=e.replace(new RegExp(s,"g"),`
`));const n=Fi(e);this.reset();const r=n.headers;let o="";for(const p in r)p.toLowerCase()==="fen"&&(o=r[p]),this.header(p,r[p]);if(!t)o&&this.load(o,{preserveHeaders:!0});else if(r.SetUp==="1"){if(!("FEN"in r))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(r.FEN,{preserveHeaders:!0})}let c=n.root;for(;c;){if(c.move){const p=this._moveFromSan(c.move,t);if(p==null)throw new Error(`Invalid move in PGN: ${c.move}`);this._makeMove(p),this._incPositionCount()}c.comment!==void 0&&(this._comments[this.fen()]=c.comment),c=c.variations[0]}const l=n.result;l&&Object.keys(this._header).length&&this._header.Result!==l&&this.setHeader("Result",l)}_moveToSan(e,t){let s="";if(e.flags&E.KSIDE_CASTLE)s="O-O";else if(e.flags&E.QSIDE_CASTLE)s="O-O-O";else{if(e.flags&E.NULL_MOVE)return Ke;if(e.piece!==O){const n=on(e,t);s+=e.piece.toUpperCase()+n}e.flags&(E.CAPTURE|E.EP_CAPTURE)&&(e.piece===O&&(s+=q(e.from)[0]),s+="x"),s+=q(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,t=!1){let s=Ge(e);if(t||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==Ke)return{color:this._turn,from:0,to:0,piece:"k",flags:E.NULL_MOVE};let n=jt(s),r=this._moves({legal:!0,piece:n});for(let A=0,k=r.length;A<k;A++)if(s===Ge(this._moveToSan(r[A],r)))return r[A];if(t)return null;let o,c,l,p,g,y=!1;if(c=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),c?(o=c[1],l=c[2],p=c[3],g=c[4],l.length==1&&(y=!0)):(c=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),c&&(o=c[1],l=c[2],p=c[3],g=c[4],l.length==1&&(y=!0))),n=jt(s),r=this._moves({legal:!0,piece:o||n}),!p)return null;for(let A=0,k=r.length;A<k;A++)if(l){if((!o||o.toLowerCase()==r[A].piece)&&S[l]==r[A].from&&S[p]==r[A].to&&(!g||g.toLowerCase()==r[A].promotion))return r[A];if(y){const b=q(r[A].from);if((!o||o.toLowerCase()==r[A].piece)&&S[p]==r[A].to&&(l==b[0]||l==b[1])&&(!g||g.toLowerCase()==r[A].promotion))return r[A]}}else if(s===Ge(this._moveToSan(r[A],r)).replace("x",""))return r[A];return null}ascii(){let e=`   +------------------------+
`;for(let t=S.a8;t<=S.h1;t++){if(fe(t)===0&&(e+=" "+"87654321"[te(t)]+" |"),this._board[t]){const s=this._board[t].type,r=this._board[t].color===I?s.toUpperCase():s.toLowerCase();e+=" "+r+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const n=this._turn;for(let r=0,o=t.length;r<o;r++)this._makeMove(t[r]),this._isKingAttacked(n)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let t=[];for(let s=S.a8;s<=S.h1;s++)this._board[s]==null?t.push(null):t.push({square:q(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in S){const t=S[e];return(te(t)+fe(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const n=t.pop();if(!n)break;e?s.push(new me(this,n)):s.push(this._moveToSan(n,this._moves())),this._makeMove(n)}return s}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const t=this._positionCount.get(e)??0;t===1?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){const e=[],t={},s=n=>{n in this._comments&&(t[n]=this._comments[n])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const n=e.pop();if(!n)break;this._makeMove(n),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const n of[L,z])t[n]!==void 0&&(t[n]?this._castling[e]|=ye[n]:this._castling[e]&=~ye[n]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(t[L]===void 0||t[L]===s[L])&&(t[z]===void 0||t[z]===s[z])}getCastlingRights(e){return{[L]:(this._castling[e]&ye[L])!==0,[z]:(this._castling[e]&ye[z])!==0}}moveNumber(){return this._moveNumber}}const j=Object.create(null);j.open="0";j.close="1";j.ping="2";j.pong="3";j.message="4";j.upgrade="5";j.noop="6";const Ee=Object.create(null);Object.keys(j).forEach(i=>{Ee[j[i]]=i});const $e={type:"error",data:"parser error"},cs=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",ls=typeof ArrayBuffer=="function",hs=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,ct=({type:i,data:e},t,s)=>cs&&e instanceof Blob?t?s(e):Xt(e,s):ls&&(e instanceof ArrayBuffer||hs(e))?t?s(e):Xt(new Blob([e]),s):s(j[i]+(e||"")),Xt=(i,e)=>{const t=new FileReader;return t.onload=function(){const s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(i)};function Qt(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let We;function an(i,e){if(cs&&i.data instanceof Blob)return i.data.arrayBuffer().then(Qt).then(e);if(ls&&(i.data instanceof ArrayBuffer||hs(i.data)))return e(Qt(i.data));ct(i,!1,t=>{We||(We=new TextEncoder),e(We.encode(t))})}const Jt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",he=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<Jt.length;i++)he[Jt.charCodeAt(i)]=i;const cn=i=>{let e=i.length*.75,t=i.length,s,n=0,r,o,c,l;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);const p=new ArrayBuffer(e),g=new Uint8Array(p);for(s=0;s<t;s+=4)r=he[i.charCodeAt(s)],o=he[i.charCodeAt(s+1)],c=he[i.charCodeAt(s+2)],l=he[i.charCodeAt(s+3)],g[n++]=r<<2|o>>4,g[n++]=(o&15)<<4|c>>2,g[n++]=(c&3)<<6|l&63;return p},ln=typeof ArrayBuffer=="function",lt=(i,e)=>{if(typeof i!="string")return{type:"message",data:fs(i,e)};const t=i.charAt(0);return t==="b"?{type:"message",data:hn(i.substring(1),e)}:Ee[t]?i.length>1?{type:Ee[t],data:i.substring(1)}:{type:Ee[t]}:$e},hn=(i,e)=>{if(ln){const t=cn(i);return fs(t,e)}else return{base64:!0,data:i}},fs=(i,e)=>{switch(e){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},us="",fn=(i,e)=>{const t=i.length,s=new Array(t);let n=0;i.forEach((r,o)=>{ct(r,!1,c=>{s[o]=c,++n===t&&e(s.join(us))})})},un=(i,e)=>{const t=i.split(us),s=[];for(let n=0;n<t.length;n++){const r=lt(t[n],e);if(s.push(r),r.type==="error")break}return s};function dn(){return new TransformStream({transform(i,e){an(i,t=>{const s=t.length;let n;if(s<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,s);else if(s<65536){n=new Uint8Array(3);const r=new DataView(n.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{n=new Uint8Array(9);const r=new DataView(n.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}i.data&&typeof i.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(t)})}})}let Ye;function ve(i){return i.reduce((e,t)=>e+t.length,0)}function be(i,e){if(i[0].length===e)return i.shift();const t=new Uint8Array(e);let s=0;for(let n=0;n<e;n++)t[n]=i[0][s++],s===i[0].length&&(i.shift(),s=0);return i.length&&s<i[0].length&&(i[0]=i[0].slice(s)),t}function pn(i,e){Ye||(Ye=new TextDecoder);const t=[];let s=0,n=-1,r=!1;return new TransformStream({transform(o,c){for(t.push(o);;){if(s===0){if(ve(t)<1)break;const l=be(t,1);r=(l[0]&128)===128,n=l[0]&127,n<126?s=3:n===126?s=1:s=2}else if(s===1){if(ve(t)<2)break;const l=be(t,2);n=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),s=3}else if(s===2){if(ve(t)<8)break;const l=be(t,8),p=new DataView(l.buffer,l.byteOffset,l.length),g=p.getUint32(0);if(g>Math.pow(2,21)-1){c.enqueue($e);break}n=g*Math.pow(2,32)+p.getUint32(4),s=3}else{if(ve(t)<n)break;const l=be(t,n);c.enqueue(lt(r?l:Ye.decode(l),e)),s=0}if(n===0||n>i){c.enqueue($e);break}}}})}const ds=4;function P(i){if(i)return gn(i)}function gn(i){for(var e in P.prototype)i[e]=P.prototype[e];return i}P.prototype.on=P.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};P.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};P.prototype.off=P.prototype.removeListener=P.prototype.removeAllListeners=P.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var s,n=0;n<t.length;n++)if(s=t[n],s===e||s.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+i],this};P.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,n=t.length;s<n;++s)t[s].apply(this,e)}return this};P.prototype.emitReserved=P.prototype.emit;P.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};P.prototype.hasListeners=function(i){return!!this.listeners(i).length};const Te=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),H=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),An="arraybuffer";function ps(i,...e){return e.reduce((t,s)=>(i.hasOwnProperty(s)&&(t[s]=i[s]),t),{})}const mn=H.setTimeout,yn=H.clearTimeout;function Oe(i,e){e.useNativeTimers?(i.setTimeoutFn=mn.bind(H),i.clearTimeoutFn=yn.bind(H)):(i.setTimeoutFn=H.setTimeout.bind(H),i.clearTimeoutFn=H.clearTimeout.bind(H))}const vn=1.33;function bn(i){return typeof i=="string"?wn(i):Math.ceil((i.byteLength||i.size)*vn)}function wn(i){let e=0,t=0;for(let s=0,n=i.length;s<n;s++)e=i.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function gs(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function _n(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function Sn(i){let e={},t=i.split("&");for(let s=0,n=t.length;s<n;s++){let r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}class En extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class ht extends P{constructor(e){super(),this.writable=!1,Oe(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new En(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=lt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=_n(e);return t.length?"?"+t:""}}class Cn extends ht{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};un(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,fn(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=gs()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let As=!1;try{As=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const kn=As;function Bn(){}class Nn extends Cn{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let s=location.port;s||(s=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(n,r)=>{this.onError("xhr post error",n,r)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}}class Y extends P{constructor(e,t,s){super(),this.createRequest=e,Oe(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const t=ps(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&s.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var n;s.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=Y.requestsCount++,Y.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Bn,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Y.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Y.requestsCount=0;Y.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",zt);else if(typeof addEventListener=="function"){const i="onpagehide"in H?"pagehide":"unload";addEventListener(i,zt,!1)}}function zt(){for(let i in Y.requests)Y.requests.hasOwnProperty(i)&&Y.requests[i].abort()}const xn=function(){const i=ms({xdomain:!1});return i&&i.responseType!==null}();class Tn extends Nn{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=xn&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Y(ms,this.uri(),e)}}function ms(i){const e=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||kn))return new XMLHttpRequest}catch{}if(!e)try{return new H[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const ys=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class On extends ht{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=ys?{}:ps(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;ct(s,this.supportsBinary,r=>{try{this.doWrite(s,r)}catch{}n&&Te(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=gs()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const je=H.WebSocket||H.MozWebSocket;class Pn extends On{createSocket(e,t,s){return ys?new je(e,t,s):t?new je(e,t):new je(e)}doWrite(e,t){this.ws.send(t)}}class Ln extends ht{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=pn(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),n=dn();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const r=()=>{s.read().then(({done:c,value:l})=>{c||(this.onPacket(l),r())}).catch(c=>{})};r();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;this._writer.write(s).then(()=>{n&&Te(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Rn={websocket:Pn,webtransport:Ln,polling:Tn},qn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Dn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function et(i){if(i.length>8e3)throw"URI too long";const e=i,t=i.indexOf("["),s=i.indexOf("]");t!=-1&&s!=-1&&(i=i.substring(0,t)+i.substring(t,s).replace(/:/g,";")+i.substring(s,i.length));let n=qn.exec(i||""),r={},o=14;for(;o--;)r[Dn[o]]=n[o]||"";return t!=-1&&s!=-1&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=In(r,r.path),r.queryKey=Mn(r,r.query),r}function In(i,e){const t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function Mn(i,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,n,r){n&&(t[n]=r)}),t}const tt=typeof addEventListener=="function"&&typeof removeEventListener=="function",Ce=[];tt&&addEventListener("offline",()=>{Ce.forEach(i=>i())},!1);class Z extends P{constructor(e,t){if(super(),this.binaryType=An,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const s=et(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=et(t.host).host);Oe(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{const n=s.prototype.name;this.transports.push(n),this._transportsByName[n]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Sn(this.opts.query)),tt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Ce.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=ds,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Z.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Z.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const n=this.writeBuffer[s].data;if(n&&(t+=bn(n)),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Te(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,n){if(typeof t=="function"&&(n=t,t=void 0),typeof s=="function"&&(n=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const r={type:e,data:t,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(Z.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),tt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=Ce.indexOf(this._offlineEventListener);s!==-1&&Ce.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Z.protocol=ds;class Un extends Z{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;Z.priorWebsocketSuccess=!1;const n=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",y=>{if(!s)if(y.type==="pong"&&y.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Z.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(g(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const A=new Error("probe error");A.transport=t.name,this.emitReserved("upgradeError",A)}}))};function r(){s||(s=!0,g(),t.close(),t=null)}const o=y=>{const A=new Error("probe error: "+y);A.transport=t.name,r(),this.emitReserved("upgradeError",A)};function c(){o("transport closed")}function l(){o("socket closed")}function p(y){t&&y.name!==t.name&&r()}const g=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",c),this.off("close",l),this.off("upgrading",p)};t.once("open",n),t.once("error",o),t.once("close",c),this.once("close",l),this.once("upgrading",p),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let Vn=class extends Un{constructor(e,t={}){const s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(n=>Rn[n]).filter(n=>!!n)),super(e,s)}};function Hn(i,e="",t){let s=i;t=t||typeof location<"u"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(typeof t<"u"?i=t.protocol+"//"+i:i="https://"+i),s=et(i)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+e,s.href=s.protocol+"://"+r+(t&&t.port===s.port?"":":"+s.port),s}const Fn=typeof ArrayBuffer=="function",Kn=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,vs=Object.prototype.toString,Gn=typeof Blob=="function"||typeof Blob<"u"&&vs.call(Blob)==="[object BlobConstructor]",Wn=typeof File=="function"||typeof File<"u"&&vs.call(File)==="[object FileConstructor]";function ft(i){return Fn&&(i instanceof ArrayBuffer||Kn(i))||Gn&&i instanceof Blob||Wn&&i instanceof File}function ke(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,s=i.length;t<s;t++)if(ke(i[t]))return!0;return!1}if(ft(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return ke(i.toJSON(),!0);for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&ke(i[t]))return!0;return!1}function Yn(i){const e=[],t=i.data,s=i;return s.data=st(t,e),s.attachments=e.length,{packet:s,buffers:e}}function st(i,e){if(!i)return i;if(ft(i)){const t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){const t=new Array(i.length);for(let s=0;s<i.length;s++)t[s]=st(i[s],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){const t={};for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=st(i[s],e));return t}return i}function jn(i,e){return i.data=it(i.data,e),delete i.attachments,i}function it(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=it(i[t],e);else if(typeof i=="object")for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=it(i[t],e));return i}const Xn=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var C;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(C||(C={}));class Qn{constructor(e){this.replacer=e}encode(e){return(e.type===C.EVENT||e.type===C.ACK)&&ke(e)?this.encodeAsBinary({type:e.type===C.EVENT?C.BINARY_EVENT:C.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===C.BINARY_EVENT||e.type===C.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Yn(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}}class ut extends P{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===C.BINARY_EVENT;s||t.type===C.BINARY_ACK?(t.type=s?C.EVENT:C.ACK,this.reconstructor=new Jn(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(ft(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(C[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===C.BINARY_EVENT||s.type===C.BINARY_ACK){const r=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(r,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(t+1)==="/"){const r=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(r,t)}else s.nsp="/";const n=e.charAt(t+1);if(n!==""&&Number(n)==n){const r=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}s.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(ut.isPayloadValid(s.type,r))s.data=r;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case C.CONNECT:return Zt(t);case C.DISCONNECT:return t===void 0;case C.CONNECT_ERROR:return typeof t=="string"||Zt(t);case C.EVENT:case C.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Xn.indexOf(t[0])===-1);case C.ACK:case C.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Jn{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=jn(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Zt(i){return Object.prototype.toString.call(i)==="[object Object]"}const zn=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ut,Encoder:Qn,get PacketType(){return C}},Symbol.toStringTag,{value:"Module"}));function K(i,e,t){return i.on(e,t),function(){i.off(e,t)}}const Zn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class bs extends P{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[K(e,"open",this.onopen.bind(this)),K(e,"packet",this.onpacket.bind(this)),K(e,"error",this.onerror.bind(this)),K(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,n,r;if(Zn.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:C.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const g=this.ids++,y=t.pop();this._registerAckCallback(g,y),o.id=g}const c=(n=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||n===void 0?void 0:n.writable,l=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!c||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var s;const n=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===e&&this.sendBuffer.splice(c,1);t.call(this,new Error("operation has timed out"))},n),o=(...c)=>{this.io.clearTimeoutFn(r),t.apply(this,c)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,n)=>{const r=(o,c)=>o?n(o):s(c);r.withError=!0,t.push(r),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...r)=>(this._queue[0],n!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(n)):(this._queue.shift(),t&&t(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:C.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case C.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case C.EVENT:case C.BINARY_EVENT:this.onevent(e);break;case C.ACK:case C.BINARY_ACK:this.onack(e);break;case C.DISCONNECT:this.ondisconnect();break;case C.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...n){s||(s=!0,t.packet({type:C.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:C.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function ne(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}ne.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=Math.floor(e*10)&1?i+t:i-t}return Math.min(i,this.max)|0};ne.prototype.reset=function(){this.attempts=0};ne.prototype.setMin=function(i){this.ms=i};ne.prototype.setMax=function(i){this.max=i};ne.prototype.setJitter=function(i){this.jitter=i};class nt extends P{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Oe(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new ne({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||zn;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Vn(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=K(t,"open",function(){s.onopen(),e&&e()}),r=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},o=K(t,"error",r);if(this._timeout!==!1){const c=this._timeout,l=this.setTimeoutFn(()=>{n(),r(new Error("timeout")),t.close()},c);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(n),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(K(e,"ping",this.onping.bind(this)),K(e,"data",this.ondata.bind(this)),K(e,"error",this.onerror.bind(this)),K(e,"close",this.onclose.bind(this)),K(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Te(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new bs(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t)if(this.nsps[s].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ce={};function Be(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};const t=Hn(i,e.path||"/socket.io"),s=t.source,n=t.id,r=t.path,o=ce[n]&&r in ce[n].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return c?l=new nt(s,e):(ce[n]||(ce[n]=new nt(s,e)),l=ce[n]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(Be,{Manager:nt,Socket:bs,io:Be,connect:Be});const $n="data:image/png;base64,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",er="data:image/png;base64,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",tr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAMiSURBVGiB7ZqxTxNRHMc/P2jC2dDCYmhtB8cuJgQaWQwFRx1kdHAQHCr/ghOyMLAQBnRhI4Q4MTBoTEzYJDQhONIOGG3aktCQGHFo6HOAMyBX2nv3oHq9T/JLmrv3fvf73nv37t7vV1FK0Ul0tTuAmyYQ7HcCwX4nEOx3AsF+R1uwiFgi8l5ElIMtiYi4aK9E5IuI3Ha4zrSI1Ftt3xSllJYBY4C6wmIu2yvgpcN1ym7aNzPPUzqTyVxwODAwYJ96IiJPbQMeOrVXSpHNZu0+6fN9zvpZAKVSyam9a0LaPRvQ399PpVIBeNvo/BXHXpzZBXp6erAsy0h8xgWvr68zOztLvV6/dM6yLObn5y8dn5mZ4fj4mIODA0efU1NTjjdKB+OCU6kUq6urrvpYlsXi4qLpUBzxLLhcLrO2tmYilpbZ29vT7+xhlX5G81X3um3Zbdyim/EQkTCQB+6Ew2HGx8fp7e3V8tUqtVqNzc1NDg8PAX4AQ0qpgisnuiN8dqP6gM+ASiaTKp/Pq+vi6OhIjYyM2CO7D9zViVl7hG1EpA/4AIwkk0nm5uYIhYyvhSwsLLC1tQXwFRhTSu3r+PEsGP6I/hSNRoeGh4fPf3wYoVqtsru7S6VSKQIPdMUC3qb0X9P7MaAymYzx6ZzNZu2p/MprnCZ3Sz8N+mpE1auDYHvodwLBficQ7HcCwX4nEOx3AsF+p+MEm9yp9wDs7OwwMTFh0C3kcjn7Z8SrL5OCnwOk02kmJycNuoVIJMLKygqcJg4vJ7bdYGjznwJqXV1dant723gCoFQqqWg0aicBHnmJ1fMIi4gFvANCg4ODFAoFCgV3icRWGB0dZWNjA2BZRO4rpb5pOTIwuh+54Xy0iHwHbrVlhIF7AIlEgu7ubgPurqZYLHJycpLgNEX8y21/Y4tWLpcjFouZcteQWCxmVye16Lj3cMcJ1lmkpoE67S+knbclzooKzcx15UFEyoDZ0oIZ4kqpcrNG2lP6/H8u2mluyzod9wxrv5bi8bjJOG4MnRF+zelC8S/xBmjp5WykXPo/0XHPcCDY7wSC/U4g2O/8BtFWHbaczITCAAAAAElFTkSuQmCC",sr="data:image/png;base64,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",ir="data:image/png;base64,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",nr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAASLSURBVGiB7ZrLS2NnGIefL6YJEuM4GaOiUvDCgJIKI0Y7KFJ3BSm00j9gil1ULbRi+1cUV92U7gahSLvUzeAiVG3QCoOggxmvgRlRY2uKSLSivl3oV2JJgyfnYrw8EDgh3+X35P3ycc7JUSLCXcJ13QGc5l74tnMvfNu5F77t3Dlh93VMqpQKAmGgEVgGfheRbUcmFxHHXkAx8CMgGV4/AaV2Z1BOnVoqpaqAKPCux+Ohra2NUChELBZjZmaGw8NDgF2gXURWbAviYHVfANLS0iJLS0uSTjwel87OTl3pKFBgWw6HZD8BJBAIyNbWlmQimUxKZWWllv7MrixO7dIdAAMDA1RUVGRsUFJSwtDQ0KX2duCU8BOAcDictVHa50/sCuKUcArg5OQka6PT01N9eGRXEKeEXwFMTExkbRSJRPRhzLYkDm1a7wPi8XgkHo9n3LR2d3fF7/frTevDG7tpKaUeA88BPB4P8Xg8Y7u3b9/idv974veDUsqe37HNlS0GXgMSCoUkFotlrK5mY2NDwuGwrvImUGZ5JpuFfwakqalJDg4Osspqjo6OpKOjQ0tP3Bhhzi8MpKioSNbW1q4kq0kkElJaWqqlO6zMZedv+EuA3t5eamtrDXUMBoP09/frt19ZmsrGCq8DMj8/b6i6ms3NTV3hPStz2XK1pJRyA0cul6sglUrh9XpzGicQCJBMJgECIpK0IptdS7oMKCgpKclZFs6FL6iyIhRg65L+A5CNjY2clvTe3p4opQQ4BgqtymXnpjUDMD09nVPnaDSqv7iXInJoVSg7haMAk5OTOXWemprSh79ZlOccG5d0OyBer1dmZ2cNLedYLCbFxcV6l/7I0lx2CV9Ifw9IdXW17OzsXEl2f39fGhoatOwvlmeyWdgNRADp7OyU4+PjrLJnZ2fS09OjZReBohsjzPn+8AXwJyBut1vGxsayCkejUfF6vVr4L+BrwJ33wsBDYPYiuHR1dcni4mJWWc3q6qp0d3en369eACryVhjwAr8CUlVVJaOjo1cS/S/j4+NSV1enpV8C/rwTBhQwqjeqN2/e5CSrSSQSUl9fr6VfAO/km/B3gDx48EAWFhZMyWpWV1elrKxMSz/PG2Ggh4v7VpFIxBJZzdzcnPh8Pi39eb4IzwEyPDxsqaxmZGREC78GXNcqDHzAxV8pV72VY5STkxOpqanR0h/nmtWqc+lv4PyvFJ/PZ9GQlykoKGBwcPDSfDlhQXUbgbPCwkJJJBK2VFdzcHAggUBAV/npdVV4CFDPnj0jGAxaMNz/4/P56Ovr02+/zWkQCyq8A8jy8rKt1dVsb2+Ly+US4G/AazivSdk6QCorKx2R1TQ2Nupl3WY0s9kl/RSgtbXV5DDGSJuvzWhfs8LvATQ3N5scxhhp84WM9jUrXApQXl5uchhjpM33yGhfs8KP4NLtVEdIm8+wsKkb8UqpaaC9trYWv9+f8zhGSaVSrKysALwSEUPL2uyTeA8B1tfXTQ5jbn4jmBX+lPML/usi+0MjGXDsSbx84c49TXsvfNu5F77t3DnhfwDnGIncxPZT9AAAAABJRU5ErkJggg==",rr="data:image/png;base64,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",or="data:image/png;base64,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",ar="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJSSURBVGiB7ZqxixNBFMa/b/HOFBGbSDRgoRCQK01IndrG1j/BI0QQ7JLG2sIg5AQ7QbCystByIYVFKq1sUh0kmyKolWE37rPwxDOG252ZzcabnR+8YsObt+/bmXkzO1mKCIqEt+sE8sYJth0n2HacYNtxgm1HWzDJEsn3JGWDHZGkgr+Q/ETyyob7HJKM0/onIiJaBqANQM6wq4r+AuD+hvsEKv5JdkH5CaXnLslvp64PUrRpkry39lspw5y22sN5mHIPu6JlO+ddMJNd/sZE8CXf97VrgKnN53N4nnddNWnqnniQ3G+1Wp9rtdoNrQCGLBaLr6PR6KaIfFFqaPKUAewBeIH8q/M7AJd1ctbu4dOQfADgab/f95rNpnG8TUynU3Q6HYjIAMAjEfmhEyeTjYeIPCO5H0XRk+VymUXIfwjDECLySkQeGgXKqoggn42I8kbDbTx2nUDeOMG24wTbjhNsO06w7TjBtuME206WB/EXG40G6vV6hiH/EAQBfN8vGwfK8H34te/7si1ms5mQ/GicZ0ZibwEIkc951h2TXI2HNMlSpVJ5MxgM9spl8xF3FnEco9frvSR5W0SOdWJkMYffrlargzAMsa3zrN9EUYQwDCsAPpCsi8h31RjGp5YkAwBVoyB6XBORQLVR4Zalwgk2nsPVatVrt9tY+8Jhq4zHY0wmE73GGkvQIYAYJ8tEt9s1X2QVGQ6H60vVEU7qUZIpF60dFqkkUhWxws1hJ9h2dAQ/xq9C8T/xHMA8jWMm/w+fJ9yQth0n2HacYNspnOCf287BmtabMhEAAAAASUVORK5CYII=",cr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAAFzUkdCAK7OHOkAAAAEZ0FNQQAAsY8L/GEFAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAABOdJREFUaEPtmk1MJEUUx4tZVlBw94CRZBNlonhCLx484LBy0QMaPwIX15AYE735EYFMSPCmBxCjG6NGbx78OIhudBPkZIx6lDVRoyHRIUvUjIO7EYcBWaT9/6erk154PdMfr1tk+Se/vOqa7nr1urqrX1dPi+M45kpSztorRocBH3QdBnzQ9Z8E3NLSkgd9IHP/mTpEgAPgBxRL4DtQwfYT/C0z8TmcBdCd4BJdChSlY9Igs8QDI8kR7XO39ognIo++/OpupqdMLmkEewImKFjqKLjLLaarrO7hNmsbqd3aVJVJwLhUOUn94m4F6itrU1WWs/Qz1kp6DSdlyZZTVZYBnwXvgN2z5Ndg2i1mIM7SaQLx3nwW/EZ3AWyA0+CE1IYmYqUW0I3gHPAH14iL4G6pLS3ESg2gAigDf0Bh2AZPSm1qIFYmBXoM/A38gUTlTXBEaj8JYmUSoHvADvB3Pi4vSD6SIFbGBboOMD30d3oP09PTzvz8vJPL5cTfffwDBiRfcREr4wKdsR1tSKlUwu6O09PTI/6+i2Vw3PORFLXnMPLle2EecLcaC/teZpuoB0y5xeRSe1tC59+FedjdulwMbHx83PT1ue8PIyMjpqOjw8zNzZlqtWrW19fN5OSkWVtbq/8uiGnpDehr8s56Q50E6GrwF5uT6Orqcra3t7FrsIaHh8VjfRSwm+g/CiojjBF8EOYjd0tWoVAwvb299fLs7KzBSTATExNmdXXVVCoVg0nM7Oxwcg/UafS1UT4eTv7o4wIxdfSPRkOWl5dxmOPk83nx9wA+9vwlQWvSusraUNra2qrbJiO6W5F8BEkrYK5YhFaxWDRTU1NmZWXF1oRSJB+BkoY9KtCjbCpl3pZ8R0VrhD8BTPrTFJOaxFIJGGfuD5jP3K1UxPflBbeYTGqZFjQDIs1CEfQSTmrNlpPJf30nBZpgk8rwdslJ/uIgViYB4khf6u/vd8rlsrO5uRmJWq3mjI2NecF+Co5JfuKieUl7KoKz7e3t9Wyqra0tEjyutbWV7fwMTqGTgQl2HKl/akGa+TTMKyyz47bzocVkxEtMoDPo30O2rCNvqDWAbgacUb1LUoNHJF9x0b6k+T6s/clEfOWMK9VLenR09POhoaGTuZzeeVxcXKzNzMx0op86HfWGOinQ0YWFhS2UVbWxseF0dnaeRFH0GxXNFY9ruru71wcHB+srHFrCCJulpaUh9HPeViWS6iWNQCswXLnU1q3o5/e2nEjak9aH1mqKgep9WeQIawHxBD4FAte3IsC8/A2gmmmpJx4ULu1rYe4DI2AA8DIPc2Mzq/oWzIEP0LdIKwRhFDtgBMUA+N+N6wFXI/x0ANZ3W8v9+HGNZUl8E/oSlMDvFn6I+xPwDy9+WHce/WY5skIHjPjugLkf3A5uAnkQ5r8baYifYLhWzXz7G/Aq4mC5uRhwI6Bj4D3uuo/haD8H6gPYCLHSA+IC+xfA3/h+hs/qLikWD7HSA3rdNvR/4pwUi0ez53DVWi39BN4HXLh/HLwFeA9qLgBW7YQqqumkhWNPwbwIOPPykfEjOO+Dsykd8MX3iIXbnFg8GFAZvi7A7hF88NbhV0J/G96LtL8NWj7yuK/HLeA2cBy8DJ6HH/77QFTsx9J+E0cVsTQN5sAEHFbaufS+12HAB12HAR9sGfMvYtotSgWVyLkAAAAASUVORK5CYII=",lr="data:image/png;base64,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",hr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAKaSURBVGiB7Zo9axVBFIafNyYoGhSNYFDUoI1CGtEgooIo/oGAhWApWlhoivgLgp32tlqJBEEsBMXGr0ILkYiVhRaCICL4gUXisbi5QaIkOzvnzL25975wujnvnIezOzs7uzIzukl9rS6gtHrAna4ecKerB9zp6jrg/lZMKmknMAbsAF4DL83sa5HJzaxYACPAA8AWxSxwBVgdXYNKbS0lHQbuA4NLDJsBDpnZ96g6itzDkgaBGywNCzAKXI2spdSiNQnsqjj2nKR9UYWUAj4SPL6ySgGndmzFd/hn8PjKKgX8Jnh8ZZUCvpMw9jdwN6qQcGBJJ4GphJQ+YFrSlpB6IjcekvYAL1j++fs/PQaOm9msZ01hHZY0AExTDxbgKI3tpqvCOizpDHAz0+YXsN3MPjuUBMTewxcdPNYA5x18FhQCLGkDcMDJ7oSTDxDX4ar75ira7egVBrzN0WtYkrzMooDfOnrNmOPKGgJsZu+AT052z518gNhV+qmTzzMnHyAW+JGDxxzwxMFnQZHA12lsD3N02cw+eBSzoOBTymHgI/+eUlaJmxE1Re6l1wIXgE01LY5JOuVYUkNBnd0LvKdeZxfHPRzPqyNgtzrCNuMW8y86bQUMrAdeOcM241pbAQMDwMMg2GZMtBPwVDCs0TjvGms5MI1TjS8FgA24nVOr12PpLLDRyWs5jUuq/cqYDSypH7iU65OgPmCidrbD5XyaMpfy3/EDGGrVJT3p4JGq5i4uWVnAkkYI/PC1jMbrJOV2+GBmfo5GJa1LTVrJwKuA/alJucCjmfm5Sp4/F3goMz9XyfP3gBO1OTM/V8nz1wae/zqYvEo6K3k7m/Pr4RytewY39S01odifeO2irvubtgfc6eoBd7q6DvgP/gH4mMhDFawAAAAASUVORK5CYII=",dt="abcdefgh",ws=[{id:"classic",name:"Classic Wood"},{id:"emerald",name:"Emerald"},{id:"midnight",name:"Midnight Slate"}],_s={w:{k:$n,q:er,r:tr,b:sr,n:ir,p:nr},b:{k:rr,q:or,r:ar,b:cr,n:lr,p:hr}},Ss=window.location.origin,fr=document.querySelector("#app"),$t=localStorage.getItem("chess-theme")||"classic",d={theme:ws.some(i=>i.id===$t)?$t:"classic",mode:"local",chess:new Se,selected:null,selectedMoves:[],engineTimer:null,promotionPending:null,socket:null,sessionId:"",myColor:null,online:null,notice:""};fr.innerHTML=`
  <main class="mx-auto grid w-full max-w-7xl gap-6 p-3 md:grid-cols-[auto_360px] md:p-8">
    <section class="panel-shell rounded-3xl border p-4 shadow-2xl md:p-5">
      <div class="mb-3 flex flex-wrap items-center justify-between gap-2">
        <div>
          <h1 class="font-title text-3xl leading-tight">Vite Chess Arena</h1>
          <p class="mt-1 font-body text-sm opacity-85">Play local, vs engine, or online session multiplayer.</p>
        </div>
        <span id="mode-chip" class="badge-chip">Local</span>
      </div>

      <div class="board-area rounded-2xl p-3">
        <div class="board-wrap">
          <div id="rank-labels" class="rank-labels" aria-hidden="true"></div>
          <div>
            <div id="board" class="chess-board" aria-label="Chess board"></div>
            <div id="file-labels" class="file-labels" aria-hidden="true"></div>
          </div>
        </div>
      </div>
    </section>

    <aside class="panel-shell rounded-3xl border p-4 shadow-2xl md:p-5">
      <h2 class="font-title text-2xl">Control Panel</h2>
      <p id="status" class="mt-2 min-h-16 font-body text-sm"></p>
      <p id="notice" class="min-h-6 font-body text-xs text-emerald-800"></p>

      <label class="mt-2 block font-body text-sm" for="mode-select">Mode</label>
      <select id="mode-select" class="mt-1 w-full rounded-xl border px-3 py-2 font-body text-sm">
        <option value="local">Local 2 Player</option>
        <option value="engine">Play vs Engine</option>
        <option value="online">Online Session</option>
      </select>

      <label class="mt-2 block font-body text-sm" for="theme-select">Theme</label>
      <select id="theme-select" class="mt-1 w-full rounded-xl border px-3 py-2 font-body text-sm"></select>

      <section id="online-controls" class="mt-3 rounded-xl border p-3 hidden">
        <h3 class="font-title text-base">Session Multiplayer</h3>
        <div class="mt-2 flex gap-2">
          <button id="create-session" class="rounded-full px-3 py-1.5 font-body text-xs font-semibold text-white">Create Session</button>
          <button id="join-session" class="rounded-full px-3 py-1.5 font-body text-xs font-semibold text-white">Join</button>
        </div>
        <input id="session-input" class="mt-2 w-full rounded-lg border px-3 py-2 font-body text-sm uppercase" placeholder="Enter session code" maxlength="6" />
        <p id="session-meta" class="mt-2 font-body text-xs"></p>
      </section>

      <div class="mb-4 mt-3 flex gap-2">
        <button id="new-game" class="rounded-full px-4 py-2 font-body text-sm font-semibold text-white transition">New Game</button>
      </div>

      <h3 class="font-title text-lg">Moves (SAN)</h3>
      <ol id="move-list" class="mt-2 max-h-[350px] list-decimal overflow-auto pl-5 font-body text-sm"></ol>
    </aside>
  </main>

  <div id="promotion-modal" class="promo-overlay hidden" role="dialog" aria-modal="true" aria-label="Choose promotion piece">
    <div class="promo-card">
      <h4 class="font-title text-xl">Choose Promotion</h4>
      <div id="promo-choices" class="promo-choices"></div>
    </div>
  </div>

  <div id="game-end-modal" class="end-overlay hidden" role="dialog" aria-modal="true" aria-label="Game over">
    <div class="end-card">
      <h4 class="font-title text-2xl">Game Over</h4>
      <p id="end-message" class="mt-2 font-body text-sm"></p>
      <button id="restart-game" class="mt-4 rounded-full px-4 py-2 font-body text-sm font-semibold text-white">Restart Game</button>
    </div>
  </div>
`;const rt=document.querySelector("#board"),es=document.querySelector("#rank-labels"),ts=document.querySelector("#file-labels"),ur=document.querySelector("#status"),ss=document.querySelector("#move-list"),Ne=document.querySelector("#theme-select"),ot=document.querySelector("#mode-select"),Xe=document.querySelector("#mode-chip"),dr=document.querySelector("#new-game"),Qe=document.querySelector("#online-controls"),pr=document.querySelector("#create-session"),gr=document.querySelector("#join-session"),ue=document.querySelector("#session-input"),Ar=document.querySelector("#session-meta"),Je=document.querySelector("#notice"),Es=document.querySelector("#promotion-modal"),is=document.querySelector("#promo-choices"),Cs=document.querySelector("#game-end-modal"),mr=document.querySelector("#end-message"),yr=document.querySelector("#restart-game");Ne.innerHTML=ws.map(i=>`<option value="${i.id}">${i.name}</option>`).join("");Ne.value=d.theme;Ne.addEventListener("change",()=>{d.theme=Ne.value,localStorage.setItem("chess-theme",d.theme),ks()});ot.addEventListener("change",()=>{Bs(ot.value)});dr.addEventListener("click",()=>{if(d.mode==="online"){d.socket&&d.socket.emit("reset-session");return}xs()});yr.addEventListener("click",()=>{if(Pe(),d.mode==="online"){d.socket&&d.socket.emit("reset-session");return}xs()});pr.addEventListener("click",async()=>{try{const e=await(await fetch(`${Ss}/api/sessions`,{method:"POST"})).json();ue.value=e.sessionId,pt(e.sessionId)}catch(i){console.error(i),G("Could not create session. Check server.")}});gr.addEventListener("click",()=>{pt(ue.value)});ue.addEventListener("keydown",i=>{i.key==="Enter"&&pt(ue.value)});rt.addEventListener("click",i=>{const e=i.target.closest("button[data-square]");!e||d.promotionPending||vr(e.dataset.square)});ks();Bs("local");function ks(){document.body.classList.remove("theme-classic","theme-emerald","theme-midnight"),document.body.classList.add(`theme-${d.theme}`)}function Bs(i){Ts(),d.mode=i,ot.value=i,d.selected=null,d.selectedMoves=[],gt(),Pe(),i==="local"&&(ns(),d.chess=new Se,Xe.textContent="Local",Qe.classList.add("hidden")),i==="engine"&&(ns(),d.chess=new Se,Xe.textContent="Engine",Qe.classList.add("hidden")),i==="online"&&(d.chess=new Se,Xe.textContent="Online",Qe.classList.remove("hidden"),Ns()),re()}function Ns(){d.socket||(d.socket=Be(Ss,{transports:["polling","websocket"]}),d.socket.on("connect",()=>{G("Realtime connected.")}),d.socket.on("disconnect",()=>{G("Realtime disconnected.")}),d.socket.on("joined-session",i=>{d.sessionId=i.sessionId,d.myColor=i.color,rs(i),G(`Joined ${i.sessionId} as ${i.color==="w"?"White":"Black"}.`)}),d.socket.on("session-update",i=>{rs(i)}),d.socket.on("session-reset",({message:i})=>{G(i)}),d.socket.on("join-error",({message:i})=>{G(i)}),d.socket.on("action-error",({message:i})=>{G(i)}),d.socket.on("connect_error",i=>{G(`Realtime connection failed: ${i.message}`)}))}function ns(){d.online=null,d.sessionId="",d.myColor=null,ue.value="",d.socket&&(d.socket.disconnect(),d.socket=null)}function pt(i){const e=String(i||"").trim().toUpperCase();if(e.length<4){G("Enter a valid session code.");return}Ns(),d.socket.emit("join-session",{sessionId:e})}function rs(i){d.online=i,d.chess.load(i.fen),d.selected=null,d.selectedMoves=[],Ar.textContent=i.sessionId?`Session: ${i.sessionId} | White ${i.players.white?"connected":"waiting"} | Black ${i.players.black?"connected":"waiting"}`:"",re()}function G(i){d.notice=i,Je.textContent=i,i&&setTimeout(()=>{Je.textContent===i&&(Je.textContent="")},3500)}function xs(){Ts(),d.chess.reset(),d.selected=null,d.selectedMoves=[],gt(),Pe(),re()}function Ts(){d.engineTimer&&(clearTimeout(d.engineTimer),d.engineTimer=null)}function os(i){return d.mode==="local"?!0:d.mode==="engine"?i==="w":d.mode==="online"?d.myColor===i:!1}function vr(i){if(Ls())return;if(d.mode==="online"&&!d.myColor){G("Create or join a session first.");return}const e=d.chess.get(i),t=d.chess.turn();if(os(t)){if(d.selected){const s=d.selectedMoves.filter(n=>n.to===i);if(s.length>0){s.length>1?br(s):Os(s[0]);return}}e&&e.color===t&&os(e.color)?(d.selected=i,d.selectedMoves=d.chess.moves({square:i,verbose:!0})):(d.selected=null,d.selectedMoves=[]),re()}}function br(i){d.promotionPending=i,is.innerHTML="";for(const e of i){const t=document.createElement("button");t.type="button",t.className="promo-btn";const s=document.createElement("img");s.src=_s[e.color][e.promotion],s.alt=`Promote to ${e.promotion.toUpperCase()}`,s.className="promo-image";const n=document.createElement("span");n.textContent=e.promotion.toUpperCase(),t.appendChild(s),t.appendChild(n),t.addEventListener("click",()=>{gt(),Os(e)}),is.appendChild(t)}Es.classList.remove("hidden")}function gt(){d.promotionPending=null,Es.classList.add("hidden")}function Os(i){if(d.selected=null,d.selectedMoves=[],d.mode==="online"){d.socket.emit("make-move",{from:i.from,to:i.to,promotion:i.promotion||void 0});return}if(!d.chess.move({from:i.from,to:i.to,promotion:i.promotion||void 0})){G("Illegal move.");return}re(),d.chess.isGameOver()?mt(At()):wr()}function wr(){d.mode!=="engine"||d.chess.isGameOver()||d.chess.turn()==="b"&&(d.engineTimer=setTimeout(()=>{const i=_r(d.chess,2);i&&(d.chess.move(i),re(),d.chess.isGameOver()&&mt(At()))},350))}function _r(i,e){const t=i.moves({verbose:!0});if(t.length===0)return null;let s=null,n=1/0;for(const r of t){i.move(r);const o=at(i,e-1,-1/0,1/0,!0);i.undo(),o<n&&(n=o,s=r)}return s}function at(i,e,t,s,n){if(e===0||i.isGameOver())return Sr(i);const r=i.moves({verbose:!0});if(n){let c=-1/0;for(const l of r)if(i.move(l),c=Math.max(c,at(i,e-1,t,s,!1)),i.undo(),t=Math.max(t,c),t>=s)break;return c}let o=1/0;for(const c of r)if(i.move(c),o=Math.min(o,at(i,e-1,t,s,!0)),i.undo(),s=Math.min(s,o),t>=s)break;return o}function Sr(i){if(i.isCheckmate())return i.turn()==="w"?-99999:99999;if(i.isDraw())return 0;const e={p:100,n:320,b:330,r:500,q:900,k:0};let t=0;const s=i.board();for(const n of s)for(const r of n){if(!r)continue;const o=e[r.type];t+=r.color==="w"?o:-o}return t}function re(){rt.innerHTML="",kr();const i=d.chess.board(),e=d.selected,t=new Map;for(const o of d.selectedMoves)t.set(o.to,o.flags.includes("c")||o.flags.includes("e"));const s=Br(d.chess,d.chess.turn()),n=d.chess.isCheck(),r=Ps();for(let o=0;o<8;o+=1)for(let c=0;c<8;c+=1){const l=r?7-o:o,p=r?7-c:c,g=`${dt[p]}${8-l}`,y=i[l][p],A=(l+p)%2===0,k=document.createElement("button");if(k.type="button",k.className=["chess-square",A?"sq-light":"sq-dark"].join(" "),k.dataset.square=g,k.setAttribute("aria-label",g),e===g&&k.classList.add("sq-selected"),t.has(g)&&k.classList.add(t.get(g)?"sq-capture":"sq-target"),n&&s===g&&k.classList.add("sq-check"),y){const b=document.createElement("img");b.src=_s[y.color][y.type],b.alt=`${y.color==="w"?"White":"Black"} ${y.type}`,b.className="piece-image",k.appendChild(b)}rt.appendChild(k)}Er(),Cr(),Ls()?mt(At()):Pe()}function Er(){let i;d.mode==="online"&&d.online?i=d.online.status:d.chess.isCheckmate()?i=`Checkmate. ${d.chess.turn()==="w"?"Black":"White"} wins.`:d.chess.isStalemate()?i="Stalemate. Draw.":d.chess.isDraw()?i="Draw.":d.chess.isCheck()?i=`${d.chess.turn()==="w"?"White":"Black"} to move (check).`:i=`${d.chess.turn()==="w"?"White":"Black"} to move.`,d.mode==="engine"&&(i+=" You play White."),d.mode==="online"&&(i+=d.myColor?` You are ${d.myColor==="w"?"White":"Black"}.`:" Join a session to play."),ur.textContent=i}function Cr(){ss.innerHTML="";const i=d.mode==="online"&&d.online?d.online.history:d.chess.history();for(let e=0;e<i.length;e+=2){const t=document.createElement("li");t.textContent=`${i[e]||""}${i[e+1]?`   ${i[e+1]}`:""}`,ss.appendChild(t)}}function kr(){const i=Ps();es.innerHTML="",ts.innerHTML="";for(let e=0;e<8;e+=1){const t=i?e+1:8-e,s=document.createElement("span");s.textContent=String(t),es.appendChild(s)}for(let e=0;e<8;e+=1){const t=i?7-e:e,s=document.createElement("span");s.textContent=dt[t],ts.appendChild(s)}}function Ps(){return d.mode==="online"&&d.myColor==="b"}function Ls(){return d.mode==="online"&&d.online?d.online.gameOver:d.chess.isGameOver()}function At(){return d.mode==="online"&&d.online?d.online.status:d.chess.isCheckmate()?`Checkmate. ${d.chess.turn()==="w"?"Black":"White"} wins.`:d.chess.isStalemate()?"Stalemate. Draw.":d.chess.isThreefoldRepetition()?"Draw by threefold repetition.":d.chess.isInsufficientMaterial()?"Draw by insufficient material.":d.chess.isDraw()?"Draw.":"Game over."}function mt(i){mr.textContent=i,Cs.classList.remove("hidden")}function Pe(){Cs.classList.add("hidden")}function Br(i,e){const t=i.board();for(let s=0;s<8;s+=1)for(let n=0;n<8;n+=1){const r=t[s][n];if(r&&r.type==="k"&&r.color===e)return`${dt[n]}${8-s}`}return null}
